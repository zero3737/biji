<!-- build time:Wed Sep 21 2022 04:11:15 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script data-ad-client="ca-pub-7534416172769714" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css?v=7.1.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2"><link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.1.2",sidebar:{position:"left",display:"post",offset:12,onmobile:!1,dimmer:!0},back2top:!0,back2top_sidebar:!0,fancybox:!0,fastclick:!0,lazyload:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="MySQL数据库管理工具phpMyAdminphpMyAdminphpMyAdmin的安装要使用phpMyAdmin必须先配置php环境。"><meta property="og:type" content="article"><meta property="og:title" content="数据库"><meta property="og:url" content="https://zero3737.gitee.io/posts/63394/index.html"><meta property="og:site_name" content="im乐"><meta property="og:description" content="MySQL数据库管理工具phpMyAdminphpMyAdminphpMyAdmin的安装要使用phpMyAdmin必须先配置php环境。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/1.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/2.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/8.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/5.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/6.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/7.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/9.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/54.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/53.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/3.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/10.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/11.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/12.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/13.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/15.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/14.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/16.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/17.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/18.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/4.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/19.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/20.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/21.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/23.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/22.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/24.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/25.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/26.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/27.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/29.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/67.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/68.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/34.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/35.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/36.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/28.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/30.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/31.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/33.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/37.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/38.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/39.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/40.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/46.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/47.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/48.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/49.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/65.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/41.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/43.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/44.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/45.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/42.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/50.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/51.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/52.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/55.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/56.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/58.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/57.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/59.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/60.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/61.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/64.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/62.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/63.png"><meta property="og:image" content="https://zero3737.gitee.io/posts/63394/66.png"><meta property="og:updated_time" content="2020-04-06T17:18:51.855Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="数据库"><meta name="twitter:description" content="MySQL数据库管理工具phpMyAdminphpMyAdminphpMyAdmin的安装要使用phpMyAdmin必须先配置php环境。"><meta name="twitter:image" content="https://zero3737.gitee.io/posts/63394/1.png"><link rel="alternate" href="/atom.xml" title="im乐" type="application/atom+xml"><link rel="canonical" href="https://zero3737.gitee.io/posts/63394/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>数据库 | im乐</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?4082c5f4a737e261906898d7d41f122b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">im乐</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Efforts may not lead to success, but please don't be discouraged</p></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div><link rel="stylesheet" href="/live2d/css/live2d.css"></header><a href="https://github.com/zero3737" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><div class="reading-progress-bar"></div><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://zero3737.gitee.io/posts/63394/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="im乐"><meta itemprop="description" content="一个专注分享互联网知识的网站，希望你会喜欢它。"><meta itemprop="image" content="/static/user_images/头像/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="im乐"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">数据库</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-01-01 00:38:48" itemprop="dateCreated datePublished" datetime="2019-01-01T00:38:48+08:00">2019-01-01</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-04-07 01:18:51" itemprop="dateModified" datetime="2020-04-07T01:18:51+08:00">2020-04-07</time> </span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">评论数：</span> <a href="/posts/63394/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/63394/" itemprop="commentCount"></span> </a></span><span id="/posts/63394/" class="leancloud_visitors" data-flag-title="数据库"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span title="本文字数">17k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">16 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="数据库管理工具"><a href="#数据库管理工具" class="headerlink" title="数据库管理工具"></a>数据库管理工具</h2><h3 id="phpMyAdmin"><a href="#phpMyAdmin" class="headerlink" title="phpMyAdmin"></a>phpMyAdmin</h3><p><a href="https://www.phpmyadmin.net/" target="_blank" rel="noopener">phpMyAdmin</a></p><ul><li><p>phpMyAdmin的安装</p><ol start="0"><li><p>要使用phpMyAdmin必须先配置php环境。</p><a id="more"></a></li><li><p>把phpMyAdmin的解压目录放在Apache的htdocs目录下。这是Apache的网站存放目录。</p><p><img src="1.png" alt></p></li><li><p>配置config.default.php文件，路径在phpMyAdmin根目录下的libraries目录。</p><ol><li><p>查找<code>$cfg[&#39;PmaAbsoluteUri&#39;]</code>，填写phpmyadmin的访问网址。</p><ul><li><p>如<code>http://localhost/phpMyAdmin/index.php</code>。</p><p><img src="2.png" alt></p></li><li><p>这里可留空。</p></li></ul></li><li><p><code>$cfg[&#39;Servers&#39;][$i][&#39;host&#39;]</code></p><ul><li>填写localhost或mysql所在服务器的ip地址。</li></ul></li><li><p><code>$cfg[&#39;Servers&#39;][$i][&#39;port&#39;]</code></p><ul><li>mysql端口，如果是默认3306，保留为空即可。</li></ul></li><li><p><code>$cfg[&#39;Servers&#39;][$i][&#39;user&#39;]</code></p><ul><li>mysql用户名。</li></ul></li><li><p><code>$cfg[&#39;Servers&#39;][$i][&#39;password&#39;]</code></p><ul><li>mysql密码，留空就行。</li></ul></li><li><p><code>$cfg[&#39;Servers&#39;][$i][&#39;auth_type&#39;]</code></p><ul><li>在此有四种模式可供选择，cookie，http，HTTP，config。<ol><li>config方式即输入phpmyadmin的访问网址即可直接进入（前提是<code>$cfg[&#39;Servers&#39;][$i][&#39;password&#39;]</code>密码配置正确），无需输入用户名和密码，是不安全的，不推荐使用。</li><li>当该项设置为cookie，http或HTTP时，登录phpmyadmin需要数据用户名和密码进行验证。</li></ol></li></ul></li><li><p><code>$cfg[&#39;blowfish_secret&#39;]</code></p><ul><li>设置短语密码。如果认证方法设置为cookie，就需要设置短语密码，不能留空，否则会在登录phpmyadmin时提示错误。</li></ul></li><li><p><code>$cfg[&#39;DefaultLang&#39;]</code></p><ul><li>选择语言，zh代表简体中文的意思。</li></ul></li></ol></li><li><p>配置完成输入<code>http://localhost/phpMyAdmin/index.php</code>即可访问。</p></li><li><p>如果遇到phpMyAdmin高级功能尚未完全设置这个问题，导入create_tables.sql文件即可。位置在phpMyAdmin根目录下的sql目录。</p></li></ol></li></ul><h3 id="HeidiSQL"><a href="#HeidiSQL" class="headerlink" title="HeidiSQL"></a>HeidiSQL</h3><p>正在努力编写中…</p><h2 id="安装多个-MySQL-服务"><a href="#安装多个-MySQL-服务" class="headerlink" title="安装多个 MySQL 服务"></a>安装多个 MySQL 服务</h2><ol><li><p>复制目录：</p><img src="8.png" width="80%"></li><li><p>配置端口（配置 MySQL 根目录下 my.ini 文件）：</p><img src="5.png" width="40%"></li><li><p>修改路径：</p><img src="6.png" width="50%"></li><li><p>以管理员身份安装 MySQL2 服务：</p><img src="7.png" width="50%"></li><li><p>连接 MySQL2 默认空密码，在 mysql 数据库中新建查询重设密码。</p><img src="9.png" width="80%"></li></ol><h2 id="树形结构数据"><a href="#树形结构数据" class="headerlink" title="树形结构数据"></a>树形结构数据</h2><p>根据 parent_id 查询父节点下的所有一级子节点。</p><img src="54.png" width="80%"><ul><li>is_parent 字段为是否为父节点（该节点是否拥有子节点）。</li></ul><h2 id="字典表设计"><a href="#字典表设计" class="headerlink" title="字典表设计"></a>字典表设计</h2><img src="53.png" width="80%"><h2 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h2><p>正在努力编写中…</p><h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>读写分离：读操作往往比写操作更吃数据库性能。</p><img src="3.png" width="50%"><ul><li>一个数据库负责写操作，另外两个数据库负责读操作。</li></ul><p>主从复制：读的数据库和负责写的数据库同步。</p><h3 id="主从库搭建"><a href="#主从库搭建" class="headerlink" title="主从库搭建"></a>主从库搭建</h3><p>主从复制原理：</p><ul><li>假设主服务器叫 A，从服务器叫 B。主从复制就是 B 跟着 A 学，A 做什么，B 就做什么。</li><li>那么 B 怎么同步 A 的动作呢？现在 A 有一个日志功能，把自己所做的增删改查的动作。</li><li>全都记录在日志中，B只需要拿到这份日志，照着日志上面的动作施加到自己身上就可以了。</li></ul><ol><li><p>要求：</p><img src="10.png" width="80%"></li><li><p>配置 MySQL 服务（不是 MySQL2 服务） my.ini 文件：</p><img src="11.png" width="80%"><ul><li>log-bin 指定二进制日志。</li><li>server-id 集群中的 MySQL 唯一标识。</li></ul></li><li><p>修改从库（MySQL2） my.ini 文件：</p><img src="12.png" width="80%"></li><li><p>重启两个 MySQL 实例（服务）：</p><img src="13.png" width="80%"></li><li><p>主库授权（Navicat 可在 mysql 数据库新建查询）：</p><img src="15.png" width="80%"></li><li><p>命令参数解释：</p><img src="14.png" width="80%"></li><li><p>查看主服务器 BIN 日志的信息：</p><img src="16.png" width="80%"><ul><li>执行完之后记录下这两值，然后在配置完从服务器之前不要对主服务器进行任何操作，因为每次操作数据库时这两值会发生改变。</li></ul></li><li><p>设置从服务器，关闭 slave: <code>stop slave;</code>（这一步可忽略）。</p><ul><li>如果你以前配置过主从的话，一定要先关闭。</li></ul></li><li><p>从服务器输入以下 mysql 语句：</p><img src="17.png" width="80%"><p>参数解释：</p><ul><li>MASTER_HOST: 设置要连接的主服务器的 ip 地址。</li><li>MASTER_USER: 设置要连接的主服务器的用户名。</li><li>MASTER_PASSWORD: 设置要连接的主服务器的密码。</li><li>MASTER_LOG_FILE: 设置要连接的主服务器的 bin 日志的日志名称，即第 3 步得到的信息。</li><li>MASTER_LOG_POS: 设置要连接的主服务器的 bin 日志的记录位置，即第 3 步得到的信息（这里注意，最后一项不需要加引号。否则配置失败）。</li></ul></li><li><p>启动从服务器 <code>start slave</code>（mysql 语句）;</p></li><li><p><code>show slave status;</code> 查看是否配置成功：</p><img src="18.png" width="80%"><ul><li>两项为 Yes 配置即成功。</li></ul></li></ol><h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><h3 id="MySQL-代理"><a href="#MySQL-代理" class="headerlink" title="MySQL 代理"></a>MySQL 代理</h3><p>解决 JAVA 连接多个数据源的问题。</p><img src="4.png" width="50%"><h3 id="mysql-proxy"><a href="#mysql-proxy" class="headerlink" title="mysql-proxy"></a>mysql-proxy</h3><ol><li><p>MySQL 官网下载 mysql-proxy。</p></li><li><p>配置：</p><img src="19.png" width="50%"><ul><li>proxy-adress mysql 代理服务器的 IP 地址和端口号。</li><li>proxy-backend-addresses 主库 IP 地址和端口号。</li><li>proxy-read-only-backend-addresses 从库 IP 地址和端口号（从库有多个可以配置多个）。</li><li>proxy-lua-script 读写分离脚本。</li></ul></li><li><p>配置环境变量：</p><img src="20.png" width="80%"></li><li><p>创建服务：</p><img src="21.png" width="80%"></li><li><p>启动服务：</p><img src="23.png" width="80%"><ul><li>如果启动失败装 VC++ 2008 运行库（64位系统：32 和 64 位都要装，32 位系统：只装 32 位）。</li></ul></li><li><p>创建连接：</p><img src="22.png" width="50%"></li></ol><h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><p>当前事务中返回最后生成的主键信息。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LAST_INSERT_ID</span>();</span><br></pre></td></tr></table></figure><h2 id="数据库存放图片-URL"><a href="#数据库存放图片-URL" class="headerlink" title="数据库存放图片 URL"></a>数据库存放图片 URL</h2><p>图片 URL 只存图片名字，如果通过日期分类，则图片 URL 为：日期 + 图片名字。</p><hr><p>数据库安装命令：<br>mysqld –remove<br>mysqld –install<br>mysqld –initialize-insecure –user=mysql<br>net start mysql<br>MySQL命令：<br>创建数据库 create database 数据库名;<br>显示所有数据库 show databases;<br>删除数据库 drop database 数据库名;<br>使用数据库 use 数据库名;<br>创建表 create table 表明(列名1 列类型1，列名2 列类型2…);<br>显示库中所有表 show tables;<br>删除表 drop table 表名;<br>想表中插入数据 insert into 表名<br>(列名1，列名2…)<br>values<br>(值1，值2…);<br>查看表中数据 select * from 表名;<br>筛选数据 where 列名 关系运算符 筛选条件;<br>修改数据 update 表名 set 列名1 等号 修改的数值1, 列名2 等号 修改的数值2;<br>删除表中数据 delete from 表名;（不是删除表）<br>搜索表中含有部分关键字的值 like<br>排序 order by 列名 asc或desc<br>约束 check(列名 关系运算符 约束条件);（MySQL无效）<br>emun(值1, 值2…);枚举法约束范围较小，枚举的值从1开始（单选）。<br>set(“选项1”,”选项2”,”选项3”,…);（多选）<br>分组 groub by 列名; 在分组的列上我们可以使用COUNT,SUM,AVG,等函数。<br>显示数据表各属性 show columns from 表名;<br>删除列 alter table 表名 drop 列名;<br>增加列 alter table 表名 add 列名 数据类型;<br>修改列属性 alter table 表名 modify 列名 数据类型;<br>外键约束 foreign key(列名) references 主表名 (主表列名);<br>增加外键属性 alter table 副表名 add foreign key (副列名) references 主表名 (主列名)<br>进价：<br>MySQL 数据类型<br>格式<br>tinyint 1字节<br>smallint 2字节<br>mediumint 3字节<br>int或integer 4 字节<br>bigint 8字节<br>float 4字节<br>double 8字节<br>char 0-255字节<br>varchar 0-65535字节<br>tinytext 0-255字节<br>text 0-65535字节<br>mediumtext 0-16777215字节<br>longtext 0-4294967295字节<br>date 3字节 YYYY-MM-DD<br>time 3字节 HH:MM:SS<br>year 1字节 YYYY<br>datetime 8字节 YYYY-MM-DD HH:MM:SS<br>engine 设置存储引擎<br>default charset 默认编码<br>not null 不允许为空, 在操作数据库时如果输入该字段的数据为NULL ，就会报错。<br>varchar(10) 可以存储的最大字符串长度为10个字节<br>InnoDB就是作为MySQL默认的存储引擎。<br>date类型插入时间格式为’YYYY-MM-DD’。<br>字符串内容用单引号括起来，数值不能用单引号括起来。<br>使用箭头标记-&gt;不是SQL语句的一部分，它仅仅表示一个新行，如果一条SQL语句太长，我们可以通过回车键来创建一个新行来编写 SQL 语句，SQL 语句的命令结束符为分号。<br>select + 列名 + from + 表名 + where + 列名 + 关系运算符 + 筛选条件;<br>where<br>= 等号<br>&lt;&gt;, != 不等于</p><blockquote><p>大于号<br>&lt; 小于号<br>= 大于等于号<br>&lt;= 小于等于号<br>or 或者<br>and 并且</p></blockquote><p>unsigned只能放在数据类型后面，unsigned int是错误的。<br>primary key 设置主键<br>primary key(列名1，列名2…) 复合主键，注意没有单引号<br>主键不能为空且值不能重复。<br>auto_increment 定义列为自增的属性，一般用于主键，数值会自动加1<br>default 设置默认值<br>auto_increment与default不能一起使用，默认值是违背自增长的。<br>auto_increment一定要与primary key一起使用。<br>默认值为not null，一定要指定默认值（default），不然会报错。<br>delete语句如果没有指定WHERE子句，MySQL 表中的所有记录将被删除。<br>like子句中使用百分号 %字符来表示任意字符，如果没有使用百分号 %, LIKE 子句与等号 = 的效果是一样的。<br>如： where name like ‘%.com’<br>now()获取系统当前时间，赋值给数据类型为date的变量，不用单引号括起来。<br>select * from 表名1<br>union<br>select * from 表名2;<br>union操作符用于连接两个以上的select语句的结果组合到一个结果集合中。<br>unique取值唯一，其值是不能改变的。<br>in操作符允许我们在where子句中规定多个值（or）。<br>如：where id in(1,2,3); where name in(‘LJL’,’KAO’);<br>count(*) 统计函数。<br>查找数值范围：where id between 1 and 3;<br>嵌套查询：select * from table1 where 列名 in (select 列名 from table2)<br>设置外键的条件：<br>该键所参考的字段必须为主键<br>两个字段必须具有相同的数据类型和约束<br>unique 标识唯一的，值不能重复。<br>having 分组筛选条件，与group by 一起使用，功能相当于where。<br>having后的判断字段必须是聚合函数返回的结果。<br>关系和属性重新命名的子句为as。<br>MySQL显示连接数：<br>show processlist;<br>数据库分类<br>关系型数据库、 非关系型数据库<br>外键：关联两个数据表<br>索引：使用索引可快速访问数据表中的特定信息，索引是对数据表中的一列或多列的值进行排序的一种结果。类似与书籍的目录。<br>mysql数据库<br>information_schema数据库 存取数据库对象信息，如用户表信息，列信息，根除，字符，分区。<br>performance_schema数据库 存储数据库服务器相关参数信息<br>sys数据库 通过这个库可以快速的了解系统的元数据信息。这个库是通过视图的形式把information_schema和performance_schema结合起来，查询出更加令人容易理解的数据。<br>mysql 存储数据库用户权限信息。<br>数据库默认端口号 3306<br>字符集<br>asscii 演变 iso-646</p><p>为了处理不同的文字，各大计算机公司、各国、标准化政府，组织先后发明了几百种字符集：<br>iso-8859 gb2312-80 gbk big5 (和ascii差不多,不过各自编码规则不一样)</p><p>统一字符 iso制定iso10646规则<br>unicodel技术委员会1991年推出了unicode1.0<br>1991年10月，iso将unicode收编，名为bmp</p><p>iso-10646编码空间足以容纳从古至今使用过的文字和字符。但很多文字字符已经很少使用。<br>Unicode双字节方式都能满足需求。<br>UTF-8是Unicode编码的一种使用方式。<br>概念<br>数据库对象 存储、管理和使用数据的不同结构形式，如：表、视图、存储过程、函数、触发器、事件等。<br>数据库： 存储数据库对象的容器。<br>存储引擎：每一种技术都使用不同的存储机制、索引技巧、锁定水平并且最终提供广泛的不同的功能和能力。通过选择不同的技术，你能够获得额外的速度或者功能，从而改善你的应用的整体功能。不同的存储引擎性能不一样。<br>什么是事物： 是指作为单个逻辑工作单元执行的一些列操作，要么完全地执行，要么完全的不执行。<br>存储引擎分类<br>MYISAM： 不支持事物、外键、但是访问速度块，对事物完整性没有要求或者以select、insert为主的应用基本都可以使用这个引擎来建表。每个MYISAM在磁盘上存储成3个文件，其中扩展名和表明都相同，扩展名为.frm(定义表结构，一个表多少列多少行)、.MYDate，存储数据、MYIndex，存取索引。<br>INNODB： INNODB存储引擎提供了具有提交、回滚和崩溃修复能力的事物安全。但是会占用更多的磁盘空间以保留数据和索引。<br>MEMORY： memory使用存在内存中的内容来建表。每个memory表实际对应一个磁盘文件，格式是.frm。memory类型的表访问速度非常快，因为他到数据是放在内存中的，并且默认使用hash索引，但是一旦服务器关闭，表中的数据就会丢失，但表还会继续存在。<br>mysql命名规则<br>采用26个英文字母(区分大小写)和0-9的自然数(经常不需要)加上下划线’<em>‘组成，命名简洁明确，多个单词用下划线’</em>‘分隔。<br>禁止使用数据库关键字，如：name，time ，datetime，password等<br>SQL数据类型<br>mysql中定义数据字段的类型对你数据库的优化是非常重要的。<br>mysql数据类型大致分为3类：数值类型、String类型、日期和时间类型。</p><p>常用的数据类型：<br>double double(5,2)表示最多5位，其中必须有2位小数，即最大值999.99<br>char 固定长度字符串类型 char(10) ‘abc ’ 必须10个字节<br>varchar 可变长度字符串类型，varchar(10) ‘abc’<br>text 字符串类型<br>date 日期类型，格式为：yyyy-MM-dd<br>time 时间类型，格式为：hh:mm:ss<br>datetime 日期时间类型，格式为：yyyy-MM-dd hh:mm:ss</p><p>varchar(25) 最多只能有25个字符。<br>int(11) 位数不够，用多少个0补齐。c10 0000000099 c11 00000000099</p><p>在mysql中，字符串类型和日期类型都要用单引号括起来。<br>mysql语言分类</p><p>ddl数据定义语言：用来定义数据库对象：创建库、表、列等（结构）<br>create database 数据库名 character set utf8;<br>数据表添加一列 alter table 表名 add 列名 数据类型<br>数据表添加约束 alter table 表名 add constraint 约束类型<br>修改一个表的字段类型 alter table 表名 modify 字段名 数据类型<br>删除表的一个字段 alter table 表名 drop 字段名<br>查看表结构 desc 表名<br>查看表的创建细节 show create table 表名<br>修改表名 rename table 原始表名 to 修改表名<br>修改表列名 alter table 表名 change 原始列名 新列名 数据类型<br>修改表字符集 alter table 表名 character set 字符编码<br>删除表 drop table 表名</p><p>dml是对表中的数据进行增删改的操作：<br>插入数据 insert into 表名（列名1, 列名2） values （列值1, 列值2）<br>插入多条数据 insert into 表名（列名1, 列名2） values (列值1, 列值2),<br>(列值1，列值2)<br>修改所有数据 update 表名 set 列名=要修改的值<br>修改指定一行 update 表名 set 列名1=要修改的值1, 列名1=要修改的值1<br>where 列名=列值<br>mysql 支持 数据库名.表名 的方式，表示数据中的那张表<br>修改数据库密码 密码保存在mysql数据库中的user表的authentication_string字段里。<br>password(‘密码’); 对密码进行加密<br>flush privileges 修改mysql密码后要刷新mysql的系统权限相关表。</p><p>修改密码另一种方法（必须退出mysql执行）:<br>mysqladmin -u root -p password 要修改的密码<br>password： 原始密码</p><p>cmd命令 cls清除cmd命令框信息（必须退出mysql执行）。</p><p>delete from 表名 where 列名 = 列值<br>删除所有记录 delete from 表名; truncate table 表名<br>delete与truncate的区别 delete删除表中的数据，表结构还在，删除后的数据可以找回<br>truncate删除是把表直接删除掉，然后在创建一个同样的新表。删除的数据不能找回。执行速度比delete快。</p><p>dql数据查询语言：<br>结果集：数据库执行dql语句不会对数据进行改变，而是让数据库发送结果集给客户端。通过查询语句查询出来的数据以表的形式展示给我们称这个表为虚拟结果集。存放在内存中。查询返回的结果集是一张虚拟表。<br>select 列名1, 列名2 form 表名<br>mysql中dql 关键字书写顺序<br>select[distinct] 优先级最高<br>from<br>join（如left join）<br>on<br>where<br>group by<br>having<br>union<br>order by<br>limit 优先级最低<br>mysql中dql 关键字执行顺序<br>from 对FROM左边的表和右边的表计算笛卡尔积，产生虚表VT1；优先级最高</p><p>on 对虚拟表VT1进行ON筛选，只有那些符合条件的行才会被记录在虚拟表VT2中；</p><p>join 如果是OUT JOIN，那么将保留表中（如左表或者右表）未匹配的行作为外部行添加到虚拟表VT2中，从而产生虚拟表VT3；</p><p>where 对虚拟表VT3进行WHERE条件过滤，只有符合的记录才会被放入到虚拟表VT4；</p><p>group by 根据GROUP BY子句中的列，对虚拟表VT4进行分组操作，产生虚拟表VT5；</p><p>having 对虚拟表VT6进行 HAVING 条件过滤，只有符合的记录才会被插入到虚拟表VT7中；<br>select 执行SELECT操作，选择指定的列，插入到虚拟表VT8中；</p><p>distinct 对虚拟表VT8中的记录进行去重，产生虚拟表VT9；</p><p>order by 将虚拟表VT9中的记录按照进行排序操作，产生虚拟表VT10；</p><p>limit 取出指定行的记录，产生虚拟表VT11，并将结果返回。优先级最低。<br>条件查询条件运算符<br>条件查询就是在查询时给出where子句，在where子句中可以使用一些运算符及关键字。<br>运算符 = != &lt;&gt;(不等于) &lt; &lt;= &gt; &gt;=<br>between………..and 在什么范围<br>in（set） 固定的范围值<br>is null(为空) is not null（不为空）<br>and与 or或 not非</p><p>in 和 等号的区别<br>= 的速度会略快，用于单值，IN 一般是用于多个值的时候比如 id in (1,2,3,15,65)</p><p>sql注释<br>mysql 用–注释<br>条件查询应用<br>select * from students where id in(1001, 1002, 1003);<br>查询id为1001,1002,1003。<br>select * from 表名 where name is not null;</p><p>模糊查询：关键字 ：like<br>通配符： _ 任意一个字母<br>查询姓名有5个字母构成，并且第5个字母为“s”的学生记录<br>select * from students where name like ‘—-s’<br>% 任意多个字母<br>查询姓名以m开头的学生记录<br>select * from 表名 where name like ‘m%’</p><p>去除重复记录 select distinct name from 表名<br>distinct关键字去除重复记录</p><p>把查询字段的结果进行运算，必须都要是数据类型<br>select <em>, 字段1+字段2 from 表名<br>对字段重命名<br>对查询结果字段起别名 select *, 字段1 + ifnull(字段2, 0) as total from 表名<br>as可省略<br>注意：as只能跟在select后面<br>排序<br>排序关键字 order by asc 从小到大（默认）<br>desc从大到小<br>注意：order by 后面必须指定字段名<br>select * from 表名 order by 字段名 asc; asc可省略<br>select * from 表名 order by 字段名1 desc, 字段名2 desc;<br>如果字段名1值相同，则按字段名2排序。<br>常用函数<br>count():统计指定列不为null的记录行数。<br>max():计算指定列的最大值，如果指定列是字符串类型，那么使用字符串排序运算；<br>min():计算指定列的最小值，如果指定列是字符串类型，那么使用字符串排序运算；<br>sum():计算指定列的数值和，如果指定列类型不是数值类型，那么计算结果为0；<br>avg():计算指定列的平均值，如果指定列类型不是数值类型，那么计算结果为0；<br>只要在Count中指定非NULL表达式，结果没有任何区别。因此当你指定Count(</em>） 或者CountCount（543）或者无论Count(‘anything’)时结果都会一样，因为这些值都不为NULL。<br>IFNULL(expr1,expr2):如果expr1不是NULL，IFNULL()返回expr1，否则它返回expr2。</p><p>查询表中有多少条记录<br>select count(*) from 表名。<br>count经常配合分组查询使用。</p><p>查询所有字段1的和<br>select sum(字段1) from 表名</p><p>聚合函数都是用在字段上。</p><p>一般在书写sql的是时候很多时候会误将聚合函数放到where后面作为条件查询，事实证明这样是无法执行的，执行会报【此处不允许使用聚合函数】异常。为什么会报异常呢？其原因很简单：<br>1、having放在group by 的后面<br>2、group by 后面只能放非聚合函数的列<br>3、where 子句的作用是在对查询结果进行分组前，将不符合where条件的行去掉，即在分组之前过滤数据，条件中不能包含聚组函数，使用where条件显示特定的行。<br>4、having 子句的作用是筛选满足条件的组，即在分组之后过滤数据，条件中经常包含聚组函数，使用having 条件显示特定的组，也可以使用多个分组标准进行分组。<br>那聚合函数在什么情况下使用或者应该处在sql文中的哪个位置呢<br>聚合函数只能在以下位置作为表达式使用：<br>1、 select 语句的选择列表（子查询或外部查询）；<br>2、 compute 或 compute by 子句；<br>3、having 子句；</p><p>—————————数据分类—————————————-<br>关键字 group by<br>select 字段名 from group by 字段名<br>当group by 单独使用时，只显示每组的第一条记录。<br>注意：使用了group by 后，要求Select出的结果字段都是可汇总的，否则就会出错。<br>GROUP BY X, Y意思是将所有具有相同X字段值和Y字段值的记录放到一个分组里。</p><p>函数 group_concat()<br>group_concat(字段名)可以作为一个输出字段来使用，表示分组之后，根据分组结果，使用group_concat来放置一组的某字段的值的集合。<br>只能写在select后面。</p><p>select 字段名1, group_concat(‘name’) from 表名 group by 字段名1<br>对字段名1进行分组，并显示每一组中的name<br>分组之后还可以对数据进行求和、平均值、最大值、最小值操作<br>select 字段名1, sum(字段名2) from 表名 group by 字段名1<br>根据字段名1进行分组，然后对每一组求和。</p><p>having关键字：<br>用来分组查询后指定一些条件来输出查询结果，having作用和where一样，但having只能用于group by。<br>where和having的区别：<br>having是在分组后对数据进行过滤<br>where是在分组前对数据进行过滤<br>where不可以使用聚合函数，having可以使用聚合函数</p><p>为什么where不能使用聚合函数？<br>where是条件查询，所以不能用聚合函数。</p><p>聚合函数是针对结果集进行的，但是where条件并不是在查询出结果集之后运行，所以主函数放在where语句中，会出现错误，</p><p>而having不一样，having是针对结果集做筛选的，所以我门一般吧组函数放在having中，用having来代替where，having一般跟在group by后</p><p>所以where后面已经是产生结果集了吗？？？？？？？？<br>—————————–关键字limit————————————————–<br>limit关键字：从哪一行开始查，总共要插几行。<br>limit 参数1,参数2 参数1：从哪一行开始插，参数2：一共要查几行。<br>———————————–ddl中数据完整性——————————————–<br>实体完整性：表中的一行（一条记录）代表一个实体。<br>主键约束特点：数据唯一，且不能为空。<br>mysql标识主键关键字 primary key<br>联合主键：多个字段生成一个主键 primary key(字段1, 字段2);<br>联合主键特点：每个主键不能为空，两个主键字段数据相同才违反联合主键约束。</p><p>唯一约束：指定列的数据不能重复，但可以为空。<br>关键字： unique<br>create table 表名(字段名1 数据类型, 字段名2 数据类型 unique);</p><p>自动增长列：指定列的数据自动增长，即使数据删除，还是从删除的序号继续往下增长。<br>关键字 auto_increment</p><p>域完整性约束：数据类型、非空约束、默认值约束（default）;<br>非空约束关键字 not null;<br>默认值约束： default</p><p>参照完整性：数据库的主键和外键类型一定要一致，两个表必须是InnoDB类型。<br>外键关键字 foreign key references（参考那张表，与那张表建立联系）<br>constraint 外键名 foreign key(字段名) references 另一张表（另一张表字段名）</p><p>———————————-表与表关系——————————————————<br>多对多关系：通过一张关系表来建立多对多关系。<br>为什么要拆分数据？<br>避免大量冗余数据的出现。<br>——————————合并结果集—————————————<br>关键字union 合并时去除重复记录<br>关键字 union all 合并时不去除重复记录<br>格式 select * from 表1 union select * from 表2<br>select * from 表1 union all select * from 表2<br>注意事项： 被合并的两个结果集：列数、列类型必须相同。<br>————————————多表查询—————————————–<br>同时查询两个表，会出现笛卡尔集的现象。<br>select * from 表1, 表2;<br>查询时给表起别名 select * from 表1 别名1, 表2 别名2;<br>多表查询是where条件中的字段名前要声明是哪张表。<br>select * from 表1, 表2 where 表1.字段1 = 表2.字段1;<br>去除笛卡尔集现象：在查询时要把主键与外键保持一致。<br>99写法： select * form 表1, 表2 where 表1.id = 表2.id(其中表1的id必须与表2的id保持一致)<br>内连接关键字：join…on<br>join后面写另外一张表。<br>on后面只写主外键的关系。<br>内连接之等值连接： select * from 表1 inner join 表2 on 表1.id = 表2.id;<br>左(外)连接：左连接就是把左边表的信息全部查出来，右边表的信息只有满足条件的才会被查出来。<br>select * form 表1 left join 表2 on 表1.id = 表2.id;<br>右连接：右连接就是把右边表的信息全部查出来，左边表的信息只有满足条件的才会被查出来。<br>select * from 表1 right join 表2 on 表1.id = 表2.id;</p><p>多表联查：<br>99写法: select * from 表1, 表2, 表3 where 表1.id = 表2.1id and 表3.id = 表2.3id<br>内连接: select * from 表1 join 表2 on 表1.id = 表2.1id<br>join 表3 on 表3.id = 表2.3id<br>on后面除了等号还可以跟其他查询条件<br>当一条sql语句包含多条子查询的时候，要注意列名冲突的问题。<br>——————————–保留小数—————————-<br>在mysql中，round函数用于数据的四舍五入，它有两种形式：<br>1、round(x,d) ，x指要处理的数，d是指保留几位小数<br>这里有个值得注意的地方是，d可以是负数，这时是指定小数点左边的d位整数位为0,同时小数位均为0；<br>2、round(x) ,其实就是round(x,0),也就是默认d为0；<br>————————————-子查询——————————————————–<br>子查询出现的位置：<br>where后，把select 查询出的结果当做另一个select的条件值。<br>from后，把查询出的结果当做一个新表，必须给派生表起别名。<br>子查询里的命名不会与括号外面造成的命名造成冲突。可以取相同的名字。</p><p>当有多个值进行比较的时候可以用一个括号括起来：<br>select * from 表名<br>where (字段1，字段2)<br>0in (select 字段1, 字段2 from emp where ename = ‘值1’);</p><p>自连接：自己连接自己，给自己起别名。<br>——————————-函数———————————————–<br>concat(s1,s2,s3…………..)<br>将传入的字符串连接成一个字符串，任何字符串与null连接结果都是null<br>insert(str, x, y, instr)<br>将字符串str从x位置开始，y个字符长的子串替换为指定的字符instr<br>日期函数：</p><p>DATE_FORMAT() 函数用于以不同的格式显示日期/时间数据。<br>DATE_FORMAT(date,format)<br>date 参数是合法的日期。format 规定日期/时间的输出格式。</p><p>NOW() 函数返回当前的日期和时间。</p><p>WEEK(date[,mode])：<br>该函数返回日期的星期数。WEEK()的两参数形式允许指定星期是否于星期天或星期一开始，以及是否返回值应该是在范围从0到53或者从1到53。如果省略了模式参数，那么使用 default_week_format 系统变量的值</p><p>MONTH函数返回一个整数，表示指定日期值的月份。 以下说明了MONTH函数的语法<br>MONTH(date);</p><p>–简单Case函数<br>CASE 字段名<br>WHEN ‘1’ THEN ‘男’<br>WHEN ‘2’ THEN ‘女’<br>ELSE ‘其他’ END<br>–Case搜索函数<br>CASE WHEN sex = ‘1’ THEN ‘男’<br>WHEN sex = ‘2’ THEN ‘女’<br>ELSE ‘其他’ END</p><p>其中then 后面跟随整型， 表示加数值， 如then 1,就是加1。</p><p>这两种方式，可以实现相同的功能。简单Case函数的写法相对比较简洁，但是和Case搜索函数相比，功能方面会有些限制，比如写判断式。<br>还有一个需要注意的问题，Case函数只返回第一个符合条件的值，剩下的Case部分将会被自动忽略。</p><p>database() 返回当前数据库名<br>version() 返回当前数据库版本<br>user() 返回当前登录用户<br>password(str) 对str进行加密<br>md5(str) 返回str的md5值<br>—————————–事务——————————————<br>事务用来管理 insert,update,delete 语句</p><p>start transaction; 开启事务<br>操作1<br>操作2<br>commit; 提交事务<br>rollback 回滚事务<br>事务没有提交之前，其数据都不会被改变<br>—————————–视图———————————————-<br>创建视图<br>create view 视图名 as （结果集）;</p><p>create algorithm = {undefined|merge|temptable} view 视图名 with check option；<br>algorithm参数： merge替换式，可以进行更新真实表中的数据<br>temptable具化式，临时表存储在内存中，所以不可以进行更新操作。<br>undefined，mysql更倾向于替换式<br>with check option 更新数据时不能插入或更新不符合视图限制条件的记录。<br>————————–存储过程——————————————–<br>declare 变量名 数据类型(大小) default 默认值;<br>declare 变量名1, 变量名2 数据类型(大小) default 默认值;<br>set 变量名 = 10; 修改变量的值。<br>select 列名 into 变量名 from 表名 给变量赋值。</p><p>定义存储过程：<br>delimiter $$ 结束符修改<br>create procedure 存储过程名(in 参数名 数据类型) in表示必须传入参数<br>begin</p><p>end$$<br>delimiter ;</p><p>call 存储过程名; 调用存储过程。<br>show procedure status 查看所有存储过程。<br>show procedure status where db = 数据库名 删除指定存储过程。<br>drop procedure 名称 删除存储过程。</p><p>存储过形参out 输出一个参数。<br>call 存储过程名称(@变量名);<br>select @变量名; 查看变量名的值，@表示传入一个地址。</p><p>inout 表示传入参数和输出值。<br>————————-自定义函数————————–<br>delimiter $$<br>create function 函数名(变量名 参数类型) returns 返回值类型<br>begin</p><p>return 变量名;<br>end$$</p><p>循环：<br>while 循环条件 do</p><p>end while;</p><p>set autocommit = 0; 默认情况下是自动提交sql语句，设置不自动提交sql语句。<br>repeat循环：<br>repeat</p><p>until 循环条件<br>end repeat;<br>commit; 提交所有sql语句。统一提交sql语句。<br>———————————–索引———————————————————–<br>不使用索引,mysql必须是从第一条记录开始读完整个表，直到找出相关的行。<br>explain sql语句 \g; 查看SQL语句有没有添加索引。<br>自动创建索引： 在表上定义了主键时，会自动创建一个对应的唯一索引。<br>在表上定义了一个外键时，会自动创建一个普通索引。<br>hash索引只有MEMORY引擎支持。</p><p>———————————定义变量———————————————-<br>一、局部变量。<br>局部变量一般用在sql语句块中，比如存储过程的begin/end。其作用域仅限于该语句块，在该语句块执行完毕后，局部变量就消失了。<br>局部变量一般用declare来声明，可以使用default来说明默认值。<br>二、用户变量。<br>用户变量的作用域要比局部变量要广。用户变量可以作用于当前整个连接，但是当当前连接断开后，其所定义的用户变量都会消失。<br>select @变量名<br>对用户变量赋值有两种方式，一种是直接用”=”号，另一种是用”:=”号。其区别在于使用set命令对用户变量进行赋值时，两种方式都可以使用；当使用select语句对用户变量进行赋值时，只能使用”:=”方式，因为在select语句中，”=”号被看作是比较操作符。</p><p>select @i:=0 from dual; 等价写法 select @i:=0;</p><p>查询结果赋值给变量：<br>select @num:=1; 或 select @num:=字段名 from 表名 where ……<br>———————————where——————————————————<br>WHERE 关键字后面接有效的表达式（definition），该表达式表示被操作的数据记录必须满足的条件。</p><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>什么是 Redis？</p><img src="24.png" width="80%"><p>Redis 特点：</p><img src="25.png" width="80%"><p>Redis 的应用：</p><img src="26.png" width="80%"><p>Redis 没有 Windows 版本：</p><img src="27.png" width="80%"><p>Redis 工具：</p><img src="29.png" width="50%"><p>Redis 采用的是基于内存的采用的是单进程单线程模型的 KV 数据库。</p><p>Redis 默认端口号是 6379。</p><h2 id="Redis-Windows-版本下载安装"><a href="#Redis-Windows-版本下载安装" class="headerlink" title="Redis Windows 版本下载安装"></a>Redis Windows 版本下载安装</h2><ol><li><p><a href="https://github.com/microsoftarchive/redis/releases" target="_blank" rel="noopener">Redis 下载地址</a></p></li><li><p>选择 zip 包。</p><img src="67.png" width="80%"></li><li><p>解压，先运行服务程序（不要关闭，最小化服务程序）再运行命令行工具。</p><img src="68.png" width="80%"></li></ol><h2 id="Redis-数据类型"><a href="#Redis-数据类型" class="headerlink" title="Redis 数据类型"></a>Redis 数据类型</h2><img src="34.png" width="80%"> <img src="35.png" width="80%"> <img src="36.png" width="80%"><h2 id="Redis-使用"><a href="#Redis-使用" class="headerlink" title="Redis 使用"></a>Redis 使用</h2><p>启动 Redis 服务（以服务程序运行）：</p><img src="28.png" width="80%"><p>打开 Redis 命令行工具：</p><img src="30.png" width="80%"><p>切换数据库：</p><img src="31.png" width="80%"><ul><li><p>Redis 默认使用 0 号库：</p><img src="33.png" width="50%"></li></ul><p>Keys 命令用于查找符合条件的 key：</p><img src="37.png" width="50%"><p>EXIXTS key 验证 key 是否存在：</p><img src="38.png" width="50%"><ul><li>1 存在，0 不存在。</li></ul><p><code>move k1 15</code> 将 k1 这条数据移动到 15 号数据库。</p><p>设置 key 过期时间和查看 key 是否过期：</p><img src="39.png" width="80%"><table><thead><tr><th align="left">命令</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">dbsize</td><td align="left">查看当前库的 key</td></tr><tr><td align="left">Flushdb</td><td align="left">清空当前库的所有 key</td></tr><tr><td align="left">Flushall</td><td align="left">删除全部库</td></tr><tr><td align="left">type key</td><td align="left">查看 key 的类型</td></tr></tbody></table><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><table><thead><tr><th align="left">命令</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">set key val</td><td align="left">向数据库插入数据</td></tr><tr><td align="left">setex key time val</td><td align="left">设置 key 的 val 为 val，过期时间为 time（单位秒）</td></tr><tr><td align="left">setnx key val</td><td align="left">key 如果存在则不插入 key，不存在 key 则插入 key</td></tr><tr><td align="left">mset k1 v1 k2 v2 …</td><td align="left">同时设置多对 key val</td></tr><tr><td align="left">mget k1 v1 k2 v2 …</td><td align="left">同时获取多对 key val</td></tr><tr><td align="left">msetnx k1 v1 k2 v2 …</td><td align="left">同时设置多对 key val，如果数据库中存在一个和语句相同的 key，这条语句不会执行。</td></tr><tr><td align="left">get key</td><td align="left">获取 key 的 val</td></tr><tr><td align="left">getset k v</td><td align="left">先获取 k，在设置 v</td></tr><tr><td align="left">del key</td><td align="left">删除 key</td></tr><tr><td align="left">append key val2</td><td align="left">向 key 中 val1 中拼接 val2</td></tr><tr><td align="left">strlen key</td><td align="left">返回 key 的长度</td></tr><tr><td align="left">incr key</td><td align="left">key 自增 1（val 必须为数字）</td></tr><tr><td align="left">decr key</td><td align="left">key 自减 1（val 必须为数字）</td></tr><tr><td align="left">incrby key num</td><td align="left">key 中的 val 和 num 相加（val 为 100，num 为 100，执行后 val 为 200）</td></tr><tr><td align="left">decrby key num</td><td align="left">key 中的 val 和 num 相减（val 为 100，num 为 100，执行后 val 为 0）</td></tr></tbody></table><p>截取和替换字符串：</p><img src="40.png" width="50%"><ul><li>getrange 截取字符串，index 从 0 开始（index 后面的参数为 end 下标）。</li><li>setrange 替换字符串，从 index 开始替换（index 后面的参数为替换内容）。</li></ul><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><table><thead><tr><th align="left">命令</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">lpush list v1 v2 v3 …</td><td align="left">向 list 中插入 v1、v2、v3（在左边（上）开始放元素：v3、v2、v1）</td></tr><tr><td align="left">rpush list v1 v2 v3 …</td><td align="left">向 list 中插入 v1、v2、v3（在右边（下）开始放元素：v1、v2、v3）</td></tr><tr><td align="left">lrange list 0 -1</td><td align="left">查看 list 中所有元素，下标从 0 开始</td></tr><tr><td align="left">lpop list</td><td align="left">弹出 list 中左（上）边的元素</td></tr><tr><td align="left">rpop list</td><td align="left">弹出 list 中右（下）边的元素</td></tr><tr><td align="left">lindex list 0</td><td align="left">查看 list 下标为 0 的元素</td></tr><tr><td align="left">llen list</td><td align="left">查看 list 中的长度</td></tr><tr><td align="left">lrem list 2 k</td><td align="left">删除 list 中 2 个 k</td></tr><tr><td align="left">ltrim list 4 6</td><td align="left">截取 list 中下标从 4 到 6 的元素</td></tr><tr><td align="left">rpoplpush list1 list2</td><td align="left">list1 中弹出一个元素放到 list2 中</td></tr><tr><td align="left">lset list 0 v</td><td align="left">更新 list 中下标为 0 的元素</td></tr><tr><td align="left">linsert list before/after v1 v2</td><td align="left">向 list 中 v1 前增加 v2（存在多个 v1，则在首次找到的 v1 前增加，之后的不会执行）</td></tr></tbody></table><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><table><thead><tr><th align="left">命令</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">sadd set v1、v2、v3…</td><td align="left">向 set 中添加 v1、v2、v3（元素不可重复）</td></tr><tr><td align="left">smembers set</td><td align="left">查看 set 中所有元素</td></tr><tr><td align="left">sismember set v</td><td align="left">查看 v 是否为 set 中的成员</td></tr><tr><td align="left">scard set</td><td align="left">获取 set 中存在几个元素</td></tr><tr><td align="left">srem set v1 v2 …</td><td align="left">删除 set 中 v1 v2 元素</td></tr><tr><td align="left">srandmember set [count]</td><td align="left">随机取出[count]（count 为负，表示可重复） set 中的元素</td></tr><tr><td align="left">spop set [count]</td><td align="left">随机出栈</td></tr><tr><td align="left">smove set1 set2 v</td><td align="left">向 set1 中 v 移动到 set2</td></tr><tr><td align="left">sdiff set1 set2</td><td align="left">返回 set1 中不与 set2 中相同的值（差集）</td></tr><tr><td align="left">sinter set1 set2</td><td align="left">返回 set1 中与 set2 中相同的值（交集）</td></tr><tr><td align="left">sunion set1 set2</td><td align="left">返回 set1 与 set2 中的并集</td></tr></tbody></table><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><table><thead><tr><th align="left">命令</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">hset map k v</td><td align="left">在 map 中添加键值对</td></tr><tr><td align="left">hmset map k1 v1 k2 v2 …</td><td align="left">向 map 中添加多个键值对时</td></tr><tr><td align="left">hget map k</td><td align="left">获取 map 中 k 对应的 v</td></tr><tr><td align="left">hmget map k1 k2 […]</td><td align="left">获取 map 中多对 k 对应的 v</td></tr><tr><td align="left">hgetall map</td><td align="left">获取 map 中所有键值对</td></tr><tr><td align="left">hdel map k1 k2 […]</td><td align="left">删除 map 中多对键</td></tr><tr><td align="left">hlen map</td><td align="left">获取 map 中的长度</td></tr><tr><td align="left">hexists map k</td><td align="left">查看 map 中的 k 是否存在</td></tr><tr><td align="left">hkeys map</td><td align="left">查看 map 中有多少个键</td></tr><tr><td align="left">hvals map</td><td align="left">查看 map 中有多少个值</td></tr><tr><td align="left">hincrby map k 1</td><td align="left">map k 对应 v 自增加 1</td></tr><tr><td align="left">hincrbyfloat map k 1.23</td><td align="left">map k 对应 v 自增加 1.23</td></tr><tr><td align="left">hsetnx map k v</td><td align="left">map 中不存在 k，则添加 k v，存在 k，则不赋值</td></tr></tbody></table><h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><img src="46.png" width="80%"><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>multi 开启事务，exec 提交事务。</p><img src="47.png" width="50%"><p>discard 放弃事务：</p><img src="48.png" width="50%"><ul><li>事务编写中语法错误，将全部不执行，就算 exec 提交事务也不会执行。</li></ul><p>没有语法错误，v1 为字符型，不能自增，产生错误，但提交会执行：</p><img src="49.png" width="50%"><h2 id="配置文件参数说明"><a href="#配置文件参数说明" class="headerlink" title="配置文件参数说明"></a>配置文件参数说明</h2><img src="65.png" width="80%"><h3 id="后台启动"><a href="#后台启动" class="headerlink" title="后台启动"></a>后台启动</h3><p>daemonize yes</p><img src="41.png" width="80%"><h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><img src="43.png" width="80%"><h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><img src="44.png" width="80%"><p>启用 AOF 方式，关闭 RDB 方式：</p><img src="45.png" width="80%"><h2 id="移除算法"><a href="#移除算法" class="headerlink" title="移除算法"></a>移除算法</h2><p>配置文件中 maxmemory-policy 选项：</p><img src="42.png" width="80%"><h2 id="Redis-映射-MySQL-数据库"><a href="#Redis-映射-MySQL-数据库" class="headerlink" title="Redis 映射 MySQL 数据库"></a>Redis 映射 MySQL 数据库</h2><p>采用 hash 类型存储 MySQL 数据：</p><ul><li>大 key: 表名</li><li>小 key: id</li><li>value: 行数据 json 字符串</li></ul><p>采用 String 类型存储 MySQL 数据：</p><ul><li>hash 类型不能设置过期时间 只能采用 string 类型。</li><li>key: 表名:每行数据标识（id）</li><li>value: 每行数据json字符串</li></ul><h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><h3 id="主从复制-1"><a href="#主从复制-1" class="headerlink" title="主从复制"></a>主从复制</h3><p>include 会覆盖 redis.conf 的配置，修改端口号：</p><img src="50.png" width="50%"><ul><li>修改进程 pid。</li></ul><p>启动 3 个 redis 服务：</p><img src="51.png" width="80%"><p>配置从库：</p><img src="52.png" width="80%"><h3 id="Redis-Cluster-集群"><a href="#Redis-Cluster-集群" class="headerlink" title="Redis-Cluster 集群"></a>Redis-Cluster 集群</h3><h4 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h4><img src="55.png" width="50%"> <img src="56.png" width="80%"> <img src="58.png" width="80%"><ul><li>redis 根据 key 决定将数据放入那个 redis 服务器。</li><li>理论上 redis 集群可以有 16383 台服务器（插槽）。</li><li>插槽为了解决 key 存放到哪台服务器上。</li></ul><h4 id="redis-集群投票机制"><a href="#redis-集群投票机制" class="headerlink" title="redis 集群投票机制"></a>redis 集群投票机制</h4><img src="57.png" width="50%"> <img src="59.png" width="80%"><h4 id="redis-搭建"><a href="#redis-搭建" class="headerlink" title="redis 搭建"></a>redis 搭建</h4><ol><li><p>环境搭建：</p><img src="60.png" width="80%"><ul><li>rubygems ruby 脚本管理工具。</li><li>redis-trib.rb 集群管理工具需要 redis-3.0.0.gem 这个 ruby 包。</li></ul></li><li><p>创建 6 个 redis 进程。</p><img src="61.png" width="50%"></li><li><p>cluster-enable 注释为是否打开 redis 集群。</p><img src="64.png" width="80%"></li><li><p>运行命令：</p><img src="62.png" width="80%"><ul><li><code>-- replicas 1</code> 参数为为每个主库设置一个从库。</li></ul></li><li><p>运行结果：</p><img src="63.png" width="80%"></li><li><p>连接</p><img src="66.png" width="80%"><ul><li><code>-c</code> 参数表示以集群方式连接 redis。</li></ul></li></ol></div><div><div><div style="text-align:center;color:#ccc;font-size:22px;letter-spacing:12px">本文结束<i class="fa fa-paw"></i>感谢您的阅读</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>im乐</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://zero3737.gitee.io/posts/63394/" title="数据库">https://zero3737.gitee.io/posts/63394/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-widgets"><div class="social_share"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/52192/" rel="next" title="优秀网站"><i class="fa fa-chevron-left"></i> 优秀网站</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/11574/" rel="prev" title="PHP">PHP <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/static/user_images/头像/avatar.gif" alt="im乐"><p class="site-author-name" itemprop="name">im乐</p><div class="site-description motion-element" itemprop="description">一个专注分享互联网知识的网站，希望你会喜欢它。</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">88</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zero3737" title="GitHub &rarr; https://github.com/zero3737" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://gitee.com/zero3737/" title="Gitee &rarr; https://gitee.com/zero3737/" rel="noopener" target="_blank"><i class="fa fa-fw fa-git"></i>Gitee</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li><a href="/posts/12fc1c4b/" title="JSP 教程" target="_blank">JSP 教程</a></li><li><a href="/posts/8dc1959/" title="JavaScript进阶之事件" target="_blank">JavaScript进阶之事件</a></li><li><a href="/posts/514ba138/" title="实例化对象（new）的过程" target="_blank">实例化对象（new）的过程</a></li><li><a href="/posts/77987eec/" title="JavaScript 中的原型链和函数原型" target="_blank">JavaScript 中的原型链和函数原型</a></li><li><a href="/posts/fed4be0c/" title="for…in 遍历对象中的属性" target="_blank">for…in 遍历对象中的属性</a></li></ul></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><h3 class="widget-title" style="text-align:center;color:#fc6423">Tag Cloud</h3><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas" style="width:100%"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA/">JAVA</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a><span class="tag-list-count">42</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发工具/">开发工具</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/教程/">教程</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务搭建/">服务搭建</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/未完待续/">未完待续</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/概念/">概念</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/科学上网/">科学上网</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网站推荐/">网站推荐</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件推荐/">软件推荐</a><span class="tag-list-count">2</span></li></ul></canvas></div></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL"><span class="nav-number">1.</span> <span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库管理工具"><span class="nav-number">1.1.</span> <span class="nav-text">数据库管理工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#phpMyAdmin"><span class="nav-number">1.1.1.</span> <span class="nav-text">phpMyAdmin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HeidiSQL"><span class="nav-number">1.1.2.</span> <span class="nav-text">HeidiSQL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装多个-MySQL-服务"><span class="nav-number">1.2.</span> <span class="nav-text">安装多个 MySQL 服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#树形结构数据"><span class="nav-number">1.3.</span> <span class="nav-text">树形结构数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字典表设计"><span class="nav-number">1.4.</span> <span class="nav-text">字典表设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分库分表"><span class="nav-number">1.5.</span> <span class="nav-text">分库分表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主从复制"><span class="nav-number">1.6.</span> <span class="nav-text">主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#主从库搭建"><span class="nav-number">1.6.1.</span> <span class="nav-text">主从库搭建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#读写分离"><span class="nav-number">1.7.</span> <span class="nav-text">读写分离</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-代理"><span class="nav-number">1.7.1.</span> <span class="nav-text">MySQL 代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysql-proxy"><span class="nav-number">1.7.2.</span> <span class="nav-text">mysql-proxy</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用函数"><span class="nav-number">1.8.</span> <span class="nav-text">常用函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库存放图片-URL"><span class="nav-number">1.9.</span> <span class="nav-text">数据库存放图片 URL</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis"><span class="nav-number">2.</span> <span class="nav-text">Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#概念"><span class="nav-number">2.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-Windows-版本下载安装"><span class="nav-number">2.2.</span> <span class="nav-text">Redis Windows 版本下载安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-数据类型"><span class="nav-number">2.3.</span> <span class="nav-text">Redis 数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-使用"><span class="nav-number">2.4.</span> <span class="nav-text">Redis 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#String"><span class="nav-number">2.4.1.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List"><span class="nav-number">2.4.2.</span> <span class="nav-text">List</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set"><span class="nav-number">2.4.3.</span> <span class="nav-text">Set</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash"><span class="nav-number">2.4.4.</span> <span class="nav-text">Hash</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事务"><span class="nav-number">2.5.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用"><span class="nav-number">2.5.1.</span> <span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置文件参数说明"><span class="nav-number">2.6.</span> <span class="nav-text">配置文件参数说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#后台启动"><span class="nav-number">2.6.1.</span> <span class="nav-text">后台启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#持久化"><span class="nav-number">2.6.2.</span> <span class="nav-text">持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RDB"><span class="nav-number">2.6.2.1.</span> <span class="nav-text">RDB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AOF"><span class="nav-number">2.6.2.2.</span> <span class="nav-text">AOF</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#移除算法"><span class="nav-number">2.7.</span> <span class="nav-text">移除算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-映射-MySQL-数据库"><span class="nav-number">2.8.</span> <span class="nav-text">Redis 映射 MySQL 数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集群"><span class="nav-number">2.9.</span> <span class="nav-text">集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#主从复制-1"><span class="nav-number">2.9.1.</span> <span class="nav-text">主从复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-Cluster-集群"><span class="nav-number">2.9.2.</span> <span class="nav-text">Redis-Cluster 集群</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#架构图"><span class="nav-number">2.9.2.1.</span> <span class="nav-text">架构图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#redis-集群投票机制"><span class="nav-number">2.9.2.2.</span> <span class="nav-text">redis 集群投票机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#redis-搭建"><span class="nav-number">2.9.2.3.</span> <span class="nav-text">redis 搭建</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><div id="landlord"><div class="message" style="opacity:0"></div><canvas id="live2d" width="300" height="380" class="live2d"></canvas></div><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2022</span> <span class="with-love" id="animate"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">im乐</span> <span class="post-meta-divider footer-ages-icon">|</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span title="站点总字数">292k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">4:25</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span>访问人数</span> <span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span>总访问量</span> <span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div><div><script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1278758248'%3E%3C/span%3E%3Cscript src='https://s9.cnzz.com/z_stat.php%3Fid%3D1278758248%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"))</script></div></div></footer></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/reading_progress/reading_progress.js"></script><script src="/js/utils.js?v=7.1.2"></script><script src="/js/motion.js?v=7.1.2"></script><script src="/js/affix.js?v=7.1.2"></script><script src="/js/schemes/pisces.js?v=7.1.2"></script><script src="/js/scrollspy.js?v=7.1.2"></script><script src="/js/post-details.js?v=7.1.2"></script><script src="/js/next-boot.js?v=7.1.2"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var GUEST=["nick","mail","link"],guest="nick,mail";guest=guest.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#comments",verify:!1,notify:!1,appId:"G2263okNhhWmY54fzXVhqqXV-MdYXbMMI",appKey:"c3Mz0H4v2spiQybEgul3ScwD",placeholder:"请输入你的内容",avatar:"mm",meta:guest,pageSize:"10",visitor:!0,lang:"zh-cn"})</script><script>function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var e=$("#local-search-input");e.attr("autocapitalize","none"),e.attr("autocorrect","off"),e.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():e,r=document.getElementById(t),s=document.getElementById(o),a=function(){var e=r.value.trim().toLowerCase(),t=e.split(/[\s\-]+/);t.length>1&&t.push(e);var o=[];if(e.length>0&&n.forEach(function(n){function r(t,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===e&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(e,t){var o="",n=t.start;return t.hits.forEach(function(t){o+=e.substring(n,t.position);var r=t.position+t.length;o+='<b class="search-keyword">'+e.substring(t.position,r)+"</b>",n=r}),o+=e.substring(n,t.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url).replace(/\/{2,}/g,"/"),d=[],g=[];if(""!=l&&(t.forEach(function(e){function t(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}d=d.concat(t(e,h,!1)),g=g.concat(t(e,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(e){b+="<a href='"+f+'\'><p class="search-result">'+s(p,e)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===t.length&&""===t[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>';else{o.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id});var a='<ul class="search-result-list">';o.forEach(function(e){a+=e.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()}),$(document).on("keyup",function(e){var t=27===e.which&&$(".search-popup").is(":visible");t&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script><script>pbOptions={},pbOptions.iconStyle="default",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Wechat,QQZone,Weibo,Douban,Mailto",new needShareButton("#needsharebutton-postbottom",pbOptions)</script><script>$(".highlight").not(".gist .highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=window.pageYOffset||document.documentElement.scrollTop;n.style.top=o+"px",n.style.position="absolute",n.style.opacity="0",n.readOnly=!0,n.value=e,document.body.appendChild(n);const a=document.getSelection(),i=a.rangeCount>0?a.getRangeAt(0):!1;n.select(),n.setSelectionRange(0,e.length),n.readOnly=!1;var l=document.execCommand("copy");l?$(this).text("复制成功"):$(this).text("复制失败"),n.blur(),$(this).blur(),i&&(a.removeAllRanges(),a.addRange(i))})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><canvas class="fireworks" width="2500" height="856" style="width:1250px;height:428px"></canvas><script src="https://cdn.jsdelivr.net/npm/animejs@2.2.0/anime.min.js"></script><script src="/static/js/cursor/fireworks2.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script><script>function timer() {
      var ages = moment.preciseDiff(moment(),moment(20190601,"YYYYMMDD"));
      //去除时分秒信息
      ages = ages.replace(/\s?\d{0,2}\s+hours?/, "");
      ages = ages.replace(/\s?\d{0,2}\s+minutes?/, "");
      ages = ages.replace(/\s?\d{0,2}\s+seconds?/, "");
      //将年月日转换为中文
      ages = ages.replace(/years?/, "年");
      ages = ages.replace(/months?/, "月");
      ages = ages.replace(/days?/, "天");
      ages = ages.replace(/\d+/g, '<span style="color:#1094e8">$&</span>');
      span.innerHTML = `网站已经运行 ${ages}`;
    }
    var span = document.createElement("span");
    //插入到agesicon之后
    var agesicon = document.querySelector(".footer-ages-icon");
    console.log(agesicon);
    document.querySelector(".copyright").insertBefore(span, agesicon.nextSibling);
    timer();</script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/bf66604c.js","daovoice"),daovoice("init",{app_id:"bf66604c"}),daovoice("update")</script><script type="text/javascript">var message_Path="/live2d/",home_Path="https://zero3737.gitee.io/"</script><script type="text/javascript" defer src="/live2d/js/message.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/z16.model.json"},display:{position:"right",width:300,height:400},mobile:{show:!1},react:{opacity:.7},log:!1})</script></body></html><!-- rebuild by neat -->